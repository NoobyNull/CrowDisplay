---
phase: 03-stats-display-companion-app
plan: 04
type: execute
wave: 3
depends_on: ["03-02", "03-03"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "Display shows live CPU, RAM, GPU, network, and disk stats updating in real time"
    - "Stats header remains visible when switching between hotkey tab pages"
    - "Media key buttons on display fire correct USB consumer control reports on PC"
    - "Companion app streams stats with no manual configuration"
  artifacts: []
  key_links: []
---

<objective>
Verify the complete Phase 3 pipeline end-to-end: companion app streaming stats through bridge to display header, and media key commands flowing from display through bridge to PC.

Purpose: Confirm all three firmware/software components work together before marking Phase 3 complete.

Output: Verified working system.
</objective>

<execution_context>
@/home/matthew/.claude/get-shit-done/workflows/execute-plan.md
@/home/matthew/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/03-stats-display-companion-app/03-01-SUMMARY.md
@.planning/phases/03-stats-display-companion-app/03-02-SUMMARY.md
@.planning/phases/03-stats-display-companion-app/03-03-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Flash both firmware images and install companion dependencies</name>
  <files></files>
  <action>
1. Build and flash bridge firmware:
   ```bash
   cd /data/Elcrow-Display-hotkeys && pio run -e running -t upload
   ```
   Wait for successful flash.

2. Build and flash display firmware:
   ```bash
   cd /data/Elcrow-Display-hotkeys && pio run -e display -t upload
   ```
   Wait for successful flash.

3. Install companion dependencies:
   ```bash
   cd /data/Elcrow-Display-hotkeys && pip install -r companion/requirements.txt
   ```

4. Start companion app:
   ```bash
   cd /data/Elcrow-Display-hotkeys && python3 companion/companion.py
   ```
   Verify it detects the serial port and begins streaming. If serial port not found, note for human verification step.
  </action>
  <verify>Both firmware images flash successfully. Companion app starts without import errors.</verify>
  <done>All three components are deployed: bridge firmware with consumer control + stats relay, display firmware with stats header + media keys, companion app streaming stats.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Human verification of complete Phase 3 pipeline</name>
  <files></files>
  <action>
Human verifies the complete Phase 3 stats pipeline and media key support:
- Stats header bar at top of display showing CPU, RAM, GPU, NET up/down, DSK
- 4 hotkey tab pages: General, Windows, Media, Dev Tools
- Media key buttons: Play/Pause, Stop, Prev, Next, Vol Up, Vol Down, Mute
- Companion app auto-detecting bridge and streaming stats at 2 Hz

Verification steps:

1. **Stats header**: Look at the display. The top 45px bar should show 6 stats labels (CPU XX%, RAM XX%, GPU XX% or N/A, up/down speeds, DSK XX%) updating every ~0.5 seconds.

2. **Stats persistence**: Swipe between the 4 tab pages (General, Windows, Media, Dev Tools). The stats header at the top must remain visible and continue updating on ALL pages.

3. **Media keys**: Navigate to the "Media" tab (3rd tab). Test each button:
   - Play/Pause: Should toggle media playback on PC
   - Volume Up/Down: Should change system volume
   - Mute: Should toggle mute
   - Next/Prev: Should skip tracks (test with a media player open)

4. **Companion app**: Check terminal running companion.py. Should show real-time stats output with no CRC errors or disconnects.

5. **Hotkey regression**: Switch to General tab, tap "Copy" (Ctrl+C). Verify it still fires correctly on the PC (open a text editor, select text, tap Copy button).
  </action>
  <verify>All 5 verification steps pass. Type "approved" if all checks pass, or describe any issues observed.</verify>
  <done>Phase 3 success criteria verified: stats header updating at 1-2 Hz, persistent across pages, media keys working, companion auto-launching, no regressions.</done>
</task>

</tasks>

<verification>
Phase 3 success criteria from ROADMAP.md:
1. Display shows a persistent stats header bar at top of screen with CPU, RAM, GPU, network, and disk usage updating at 1-2 Hz
2. Stats header remains visible while user navigates between hotkey pages
3. Bridge relays media key commands (play/pause, volume, next/prev, mute) from display to PC as USB consumer control reports
4. Companion app launches on Linux PC and begins streaming stats with no manual configuration
</verification>

<success_criteria>
All 4 ROADMAP success criteria verified by human testing. No regressions in existing hotkey functionality.
</success_criteria>

<output>
After completion, create `.planning/phases/03-stats-display-companion-app/03-04-SUMMARY.md`
</output>
