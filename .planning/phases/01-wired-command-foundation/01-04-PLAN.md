---
phase: 01-wired-command-foundation
plan: 04
type: execute
wave: 3
depends_on: ["01-02", "01-03"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "User taps a hotkey button on the display and the corresponding keyboard shortcut fires on the PC within 50ms"
    - "User can swipe between 3 pages of 12 hotkey buttons each"
    - "Buttons show visible press feedback (color darken + shrink) on tap"
    - "Bridge ESP32-S3 appears as a standard USB HID keyboard on the PC with no driver installation"
    - "Touch input remains stable with no I2C bus corruption during sustained use"
  artifacts: []
  key_links:
    - from: "display/uart_link.cpp"
      to: "bridge/uart_link.cpp"
      via: "UART wire: display TX (GPIO10) → bridge RX (GPIO18)"
      pattern: "BridgeSerial|DisplaySerial"
---

<objective>
Verify end-to-end hotkey delivery: user taps a button on the display, the keystroke fires on the PC. This checkpoint validates the complete Phase 1 pipeline.

Purpose: Confirm that the display firmware (Plan 03) and bridge firmware (Plan 02) work together over the UART link. This is the Phase 1 success criteria validation.

Output: Verified end-to-end system or specific issues to fix.
</objective>

<execution_context>
@/home/matthew/.claude/get-shit-done/workflows/execute-plan.md
@/home/matthew/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-wired-command-foundation/01-01-SUMMARY.md
@.planning/phases/01-wired-command-foundation/01-02-SUMMARY.md
@.planning/phases/01-wired-command-foundation/01-03-SUMMARY.md
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <name>End-to-end hotkey verification</name>
  <files></files>
  <action>
Flash both firmware targets and wire the UART connection. This is a human verification checkpoint -- no code changes needed.
  </action>
  <what-built>
Complete Phase 1 hotkey pipeline: CrowPanel display with 3-page swipeable hotkey grid → UART link → ESP32-S3 bridge → USB HID keyboard → PC.

The display shows 36 hotkey buttons across 3 pages (General, Windows, Dev Tools) with per-button color coding, LVGL symbol icons, text labels, and press feedback (darken + shrink). Tapping a button sends a binary-framed UART message to the bridge, which fires the keystroke as a USB HID keyboard event on the PC.
  </what-built>
  <how-to-verify>
**Setup:**
1. Flash display firmware: `pio run -e display -t upload` (via /dev/ttyUSB1 to CrowPanel)
2. Flash bridge firmware: `pio run -e bridge -t upload` (via appropriate port to DevKitC-1)
3. Connect UART wire: Display GPIO 10 (TX) → Bridge GPIO 18 (RX), Display GPIO 11 (RX) → Bridge GPIO 17 (TX), common GND
4. Plug bridge USB into PC
5. Open a text editor on PC

**Test 1 - USB HID Recognition:**
- Run `lsusb` -- should show "HotkeyBridge" or an Espressif HID device
- Run `dmesg | tail` -- should show "input:" line for new HID device
- Expected: Bridge recognized as USB HID keyboard, no driver installation needed

**Test 2 - Basic Hotkey:**
- On display, tap "Copy" button (Page 1)
- Expected: Ctrl+C fires in the text editor (if text is selected, it copies)
- On display, tap "Paste" button
- Expected: Ctrl+V fires (pastes copied text)

**Test 3 - Modifier Combos:**
- Tap "Undo" (Ctrl+Z), "Redo" (Ctrl+Shift+Z), "Lock" (GUI+L)
- Expected: Each fires the correct modifier+key combo on PC

**Test 4 - Multi-Page Swipe:**
- Swipe left on display to go to Page 2 (Windows)
- Tap "Desktop" (GUI+D)
- Expected: Windows desktop shown
- Swipe to Page 3 (Dev Tools)
- Tap "Terminal" (Ctrl+`)
- Expected: VS Code terminal toggles (if VS Code is open)

**Test 5 - Press Feedback:**
- Tap any button and hold briefly
- Expected: Button visually darkens and shrinks while pressed, returns to normal on release

**Test 6 - Sustained Use:**
- Tap buttons rapidly (10+ taps across different pages) for 30 seconds
- Expected: All keystrokes fire correctly, touch remains responsive, no I2C errors in serial log

**Test 7 - Latency:**
- Subjective: Does the keystroke feel instant when you tap? Should be imperceptible delay (<50ms)
  </how-to-verify>
  <resume-signal>Type "approved" if all tests pass, or describe specific issues found</resume-signal>
  <verify>Human executes the 7 test scenarios listed in how-to-verify</verify>
  <done>All 7 tests pass: USB HID recognized, basic hotkeys fire, modifier combos work, page swipe works, press feedback visible, sustained use stable, latency imperceptible</done>
</task>

</tasks>

<verification>
All Phase 1 success criteria validated by human tester:
1. Hotkey button tap → keystroke fires on PC within 50ms
2. 3 pages of 12 buttons with swipe navigation
3. Press feedback visible on tap
4. Bridge is standard USB HID keyboard (no drivers)
5. Touch stable under sustained use
</verification>

<success_criteria>
Human verifies end-to-end hotkey delivery works across all 3 pages with correct modifier combos, visible press feedback, and stable touch input. Phase 1 is complete.
</success_criteria>

<output>
After completion, create `.planning/phases/01-wired-command-foundation/01-04-SUMMARY.md`
</output>
